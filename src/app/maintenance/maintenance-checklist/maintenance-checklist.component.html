<form [formGroup]="mainForm" (ngSubmit)="saveForm()" *ngIf="mainForm">
  <div class="flex justify-content-end">
    <p-button
      label="Save"
      styleClass="p-button-raised mb-2 mr-1"
      type="submit"
      [disabled]="mainForm.invalid"
    ></p-button>
    <p-button
      label="Reset"
      styleClass="p-button-raised p-button-help mb-2 mr-1"
      (onClick)="resetForm()"
    ></p-button>
    <div>
      <p class="p-input-icon-right">
        <i class="fa-solid fa-filter fa-fw"></i>
        <input type="text" pInputText (keyup)="filterMaintItems($event)" />
      </p>
    </div>
  </div>
  <p-accordion [multiple]="true">
    <p-accordionTab
      [header]="category.label"
      [selected]="category.isExpanded"
      *ngFor="let category of categories"
    >
      <ng-container
        *ngTemplateOutlet="tasks; context: { items: category.filteredItems }"
      ></ng-container>
    </p-accordionTab>
  </p-accordion>

  <ng-template #tasks let-items="items">
    <ng-container *ngIf="items.length">
      <div class="grid">
        <div class="col-6 pb-0">
          <p class="font-bold">Task</p>
        </div>
        <div class="col-2 pb-0"><p class="font-bold">Last Completed</p></div>
        <div class="col-2 pb-0"><p class="font-bold">Due Date</p></div>
        <div class="col-2 pb-0"><p class="font-bold">Next due date</p></div>
      </div>
      <hr />

      <div class="grid">
        <ng-container *ngFor="let item of items">
          <div
            checklistRowStatus
            [doneDate]="mainForm.get(item.control + 'Date')?.value"
            [dueDate]="mainForm.get(item.control + 'DueDate')?.value"
          >
            <div class="col-6">
              <span class="vertical-align-sub">{{ item.label }}</span>
            </div>
            <div class="col-2">
              <p-calendar
                [formControlName]="item.control + 'Date'"
                [showIcon]="true"
                [showButtonBar]="true"
              ></p-calendar>
            </div>
            <div class="col-2">
              <p-calendar
                [formControlName]="item.control + 'DueDate'"
                [showIcon]="true"
                [showButtonBar]="true"
              ></p-calendar>
            </div>
            <div class="col-2">
              <div class="next-due-date-btns">
                <p-button
                  label="+Wk"
                  styleClass="p-button-raised"
                  (click)="updateDueDate(item.control, { weeks: 1 })"
                ></p-button>
                <p-button
                  label="+Mo"
                  styleClass="p-button-raised"
                  (click)="updateDueDate(item.control, { months: 1 })"
                ></p-button>
                <p-button
                  label="+Yr"
                  styleClass="p-button-raised"
                  (click)="updateDueDate(item.control, { years: 1 })"
                ></p-button>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
    </ng-container>
  </ng-template>
</form>

<p-toast position="top-right"></p-toast>
